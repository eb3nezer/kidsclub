<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>Albums</title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="stylesheet" type="text/css" href="/webjars/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/webjars/toastr/build/toastr.min.css"/>
    <link rel="stylesheet" type="text/css" href="/secure/css/kidsclub.css"/>
    <script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/webjars/toastr/build/toastr.min.js"></script>
    <script type="text/javascript" src="/secure/js/load_project.js"></script>
    <script type="text/javascript" src="/secure/js/load_albums.js"></script>
    <script type="text/javascript" src="/secure/js/text_utils.js"></script>
    <script>
        var projectId;
        var albumId;

        function renderProject(project) {
            $("#create_link").attr('href', `create_album.html#project=${project.id}`);
            $("#add_link").attr('href', `upload_photo.html#project=${projectId}&album=${albumId}`);
            $("#project_home_link").attr('href', `project_home.html#project=${project.id}`);
            $("#project_home_link").text(`${project.name} Home`);
            $("#albums_link").attr('href', `list_albums.html#project=${project.id}`);
            $("#albums_link").text(`Photo Albums for ${project.name}`);
        }

        function loadProjectFailed() {
            toastr.error('Failed to get project data', 'Failed');
        }

        function renderAlbum(album) {
            document.title = album.name;
            $("#page_heading").text(album.name);
            if (album.description) {
                $("#album_description").text(album.description);
            }
            var imagesHtml = "";
            $.each(album.items, function(index, item) {
                var imageURL = `/rest/data/download/${item.mediaDescriptor}`;
                var imageName = escapeHtml(item.description);
                imagesHtml += `<div class="album_item"><a href="${imageURL}"><img class="album_image" src="${imageURL}" width="100" alt="${imageName}"></a><div class="image_desc">${imageName}</div></div>`;
            });
            $("#album_result").html(imagesHtml);
        }

        function loadAlbumFailed() {
            toastr.error('Failed to get album data', 'Failed');
        }

        function getData() {
            var results = new RegExp('#project=([^&#]*)').exec(window.location.href);
	        projectId = results[1] || 0;
	        if (!projectId) {
	            window.location.href="index.html";
	        }
            results = new RegExp('[#&]album=([^&#]*)').exec(window.location.href);
	        albumId = results[1] || 0;
	        if (!albumId) {
	            window.location.href=`list_albums.html#project=${project}`;
	        }

            loadProject(projectId, renderProject, loadProjectFailed);
            loadAlbum(albumId, renderAlbum, loadAlbumFailed);
        }
    </script>
</head>
<body>
<h1 id="page_heading">Photo Album</h1>
<div class="album_description" id="album_description"></div>
<div id="album_result" class="album_container"></div>
<div class="navigation_links">
<ul>
    <li><a href="upload_photo.html" id="add_link">Add a photo to the album</a></li>
    <li><a id="albums_link">Albums</a></li>
    <li><a href="project_home.html" id="project_home_link">Back</a></li>
</ul>
<p><a href="../logout">Log out</a></p>
</div>
<script>
    getData();
</script>
</body>
</html>