<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>View Students</title>
    <meta name="description" content=""/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="stylesheet" type="text/css" href="/webjars/bootstrap/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/webjars/toastr/build/toastr.min.css"/>
    <script type="text/javascript" src="/webjars/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/webjars/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/webjars/toastr/build/toastr.min.js"></script>
    <script type="text/javascript" src="/secure/js/load_project.js"></script>
    <script type="text/javascript" src="/secure/js/load_teams.js"></script>
    <script type="text/javascript" src="/secure/js/text_utils.js"></script>

    <script>
        var projectId;
        var teamId;

        function renderTeam(team) {
            $("#page_heading").text(team.name);
            $("#score").text(team.score);
            if (team.mediaDescriptor) {
                $("#team_logo").html(`<img src="../../rest/data/download/${team.mediaDescriptor}" width='200'/>`);
            } else if (team.avatarUrl) {
                $("#team_logo").html(`<img src="${avatarUrl}" width='200'/>`);
            }
            var html = "<ul>";
            $.each(team.students, function(index, student) {
                var name = escapeHtml(student.name);
                var alert = "";
                if (student.specialInstructions) {
                    alert = " <img src='/secure/icons/exclamation.gif' alt='Notes' height='25'>";
                }
                html = html + `<li><a href="view_student.html#project=${projectId}&student=${student.id}">${name}</a>${alert}</li>`;
            });
            html = html + "</ul>";
            $("#student_list").html(html);
        }

        function teamLoadError() {
            toastr.error('Failed to load team', 'Failed');
        }

        function renderProject(project) {
            $("#add_link").attr('href', `add_student.html#project=${project.id}`);
            $("#project_home_link").attr('href', `project_home.html#project=${project.id}`);
            $("#project_home_link").text(`${project.name} Home`);
        }

        function projectLoadError() {
            toastr.error('Failed to load project', 'Failed');
        }

        function getData() {
            var results = new RegExp('#project=([^&#]*)').exec(window.location.href);
	        var project = results[1] || 0;
	        if (!project) {
	            window.location.href="./index.html";
	        }
	        projectId = project;

	        results = new RegExp('[#&]team=([^&#]*)').exec(window.location.href);
	        teamId = results[1] || 0;
	        if (!teamId) {
	            window.location.href=`project_home.html#project=${project}`;
	        }

            loadProject(projectId, renderProject, projectLoadError);
            loadTeam(teamId, renderTeam, teamLoadError);
        }

        function doAdjustPoints(amount) {
            adjustPoints(teamId, amount, function(team) {
                $("#score").text(team.score);
            }, teamLoadError);
        }
</script>
</head>
<body>
<h1 id="page_heading"></h1>
<p><div id="team_logo"></div></p>
<h3>Current Points: <div id="score"></div></h3>
<p>
    <button type="submit" class="btn" onclick="doAdjustPoints(100); return false;">+100</button>
    <button type="submit" class="btn" onclick="doAdjustPoints(-100); return false;">-100</button>
</p>
<h2>Students in this team</h2>
<div id="student_list"></div>
<ul>
    <li><a href="project_home.html" id="project_home_link">Back</a></li>
</ul>
<ul>
    <li><a href="../logout">Log out</a></li>
</ul>
<script>
    getData();
</script>
</body>
</html>